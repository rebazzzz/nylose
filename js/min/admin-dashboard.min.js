function showSection(t){document.querySelectorAll(".content-section").forEach(t=>t.style.display="none");var e=document.getElementById(t+"-section");if(e)switch(e.style.display="block",t){case"users":loadUsers();break;case"sports":loadSports();break;case"schedules":loadSchedules();break;case"statistics":loadStatistics()}}function hideAllSections(){document.querySelectorAll(".content-section").forEach(t=>t.style.display="none")}function showAddSportModal(){document.getElementById("add-sport-modal").style.display="block"}function showAddScheduleModal(){document.getElementById("add-schedule-modal").style.display="block"}function closeModal(t){document.getElementById(t).style.display="none"}async function loadDashboardCounts(){try{var[t,e,o]=await Promise.all([fetch("http://localhost:3001/api/admin/users",{headers:{Authorization:"Bearer "+localStorage.getItem("token")}}),fetch("http://localhost:3001/api/admin/sports",{headers:{Authorization:"Bearer "+localStorage.getItem("token")}}),fetch("http://localhost:3001/api/admin/schedules",{headers:{Authorization:"Bearer "+localStorage.getItem("token")}})]),a=await t.json(),n=await e.json(),d=await o.json();document.getElementById("members-count").textContent=a.length+" medlemmar",document.getElementById("sports-count").textContent=n.length+" sporter",document.getElementById("schedules-count").textContent=d.length+" scheman"}catch(t){console.error("Error loading dashboard counts:",t),document.getElementById("members-count").textContent="Kunde inte ladda",document.getElementById("sports-count").textContent="Kunde inte ladda",document.getElementById("schedules-count").textContent="Kunde inte ladda"}}function showSection(t){document.querySelectorAll(".content-section").forEach(t=>t.style.display="none");var e=document.getElementById(t+"-section");if(e)switch(e.style.display="block",t){case"users":loadUsers();break;case"sports":loadSports();break;case"schedules":loadSchedules();break;case"statistics":loadStatistics()}}function hideAllSections(){document.querySelectorAll(".content-section").forEach(t=>t.style.display="none")}async function loadUsers(){try{var t=await fetch("http://localhost:3001/api/admin/users",{headers:{Authorization:"Bearer "+localStorage.getItem("token")}});if(!t.ok)throw new Error("Failed to fetch users");var e=await t.json(),o=document.getElementById("users-tbody");0===e.length?o.innerHTML='<tr><td colspan="7">Inga medlemmar registrerade</td></tr>':o.innerHTML=e.map(t=>`
            <tr>
                <td>${t.id}</td>
                <td>${t.first_name} ${t.last_name}</td>
                <td>${t.email}</td>
                <td>${t.phone||"-"}</td>
                <td>${t.membership_type||"Grund"}</td>
                <td>
                    <span class="status ${t.is_active?"active":"inactive"}">
                        ${t.is_active?"Aktiv":"Inaktiv"}
                    </span>
                </td>
                <td>
                    <button class="btn btn-small" onclick="toggleUserStatus(${t.id}, ${!t.is_active})">
                        ${t.is_active?"Inaktivera":"Aktivera"}
                    </button>
                </td>
            </tr>
        `).join("")}catch(t){console.error("Error loading users:",t),document.getElementById("users-tbody").innerHTML='<tr><td colspan="7">Kunde inte ladda medlemmar</td></tr>'}}async function loadSports(){try{var t=await fetch("http://localhost:3001/api/admin/sports",{headers:{Authorization:"Bearer "+localStorage.getItem("token")}});if(!t.ok)throw new Error("Failed to fetch sports");var e=await t.json(),o=document.getElementById("sports-tbody");0===e.length?o.innerHTML='<tr><td colspan="4">Inga sporter tillgängliga</td></tr>':o.innerHTML=e.map(t=>`
            <tr>
                <td>${t.id}</td>
                <td>${t.name}</td>
                <td>${t.description}</td>
                <td>
                    <button class="btn btn-small" onclick="editSport(${t.id})">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button class="btn btn-small btn-danger" onclick="deleteSport(${t.id})">
                        <i class="fas fa-trash"></i>
                    </button>
                </td>
            </tr>
        `).join("")}catch(t){console.error("Error loading sports:",t),document.getElementById("sports-tbody").innerHTML='<tr><td colspan="4">Kunde inte ladda sporter</td></tr>'}}async function loadSchedules(){try{var t=await fetch("http://localhost:3001/api/admin/schedules",{headers:{Authorization:"Bearer "+localStorage.getItem("token")}});if(!t.ok)throw new Error("Failed to fetch schedules");var e=await t.json(),o=document.getElementById("schedules-tbody");0===e.length?o.innerHTML='<tr><td colspan="6">Inga scheman tillgängliga</td></tr>':o.innerHTML=e.map(t=>`
            <tr>
                <td>${t.id}</td>
                <td>${t.sport_name}</td>
                <td>${t.day_of_week||t.day}</td>
                <td>${t.start_time} - ${t.end_time}</td>
                <td>${t.age_group}</td>
                <td>
                    <button class="btn btn-small" onclick="editSchedule(${t.id})">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button class="btn btn-small btn-danger" onclick="deleteSchedule(${t.id})">
                        <i class="fas fa-trash"></i>
                    </button>
                </td>
            </tr>
        `).join("")}catch(t){console.error("Error loading schedules:",t),document.getElementById("schedules-tbody").innerHTML='<tr><td colspan="7">Kunde inte ladda schema</td></tr>'}}async function loadStatistics(){try{var t=await fetch("http://localhost:3001/api/admin/statistics",{headers:{Authorization:"Bearer "+localStorage.getItem("token")}});if(!t.ok)throw new Error("Failed to fetch statistics");var e=await t.json();document.getElementById("statistics-content").innerHTML=`
            <div class="stats-grid">
                <div class="stat-card">
                    <h3>Totalt antal medlemmar</h3>
                    <p class="stat-number">${e.totalUsers}</p>
                </div>
                <div class="stat-card">
                    <h3>Aktiva medlemmar</h3>
                    <p class="stat-number">${e.activeUsers}</p>
                </div>
                <div class="stat-card">
                    <h3>Totalt antal sporter</h3>
                    <p class="stat-number">${e.totalSports}</p>
                </div>
                <div class="stat-card">
                    <h3>Totalt antal scheman</h3>
                    <p class="stat-number">${e.totalSchedules}</p>
                </div>
                <div class="stat-card">
                    <h3>Totala betalningar</h3>
                    <p class="stat-number">${e.totalPayments} kr</p>
                </div>
                <div class="stat-card">
                    <h3>Genomsnittlig betalning</h3>
                    <p class="stat-number">${e.averagePayment} kr</p>
                </div>
            </div>
        `}catch(t){console.error("Error loading statistics:",t),document.getElementById("statistics-content").innerHTML="Kunde inte ladda statistik"}}async function loadSportsForSelect(){try{var t=await fetch("http://localhost:3001/api/admin/sports",{headers:{Authorization:"Bearer "+localStorage.getItem("token")}});if(!t.ok)throw new Error("Failed to fetch sports");let e=await t.json();["schedule-sport","edit-schedule-sport"].forEach(t=>{t=document.getElementById(t);t&&(t.innerHTML='<option value="">Välj sport...</option>'+e.map(t=>`<option value="${t.id}">${t.name}</option>`).join(""))})}catch(t){console.error("Error loading sports for select:",t)}}async function toggleUserStatus(t,e){try{if(!(await fetch(`http://localhost:3001/api/admin/users/${t}/status`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer "+localStorage.getItem("token")},body:JSON.stringify({is_active:e})})).ok)throw new Error("Failed to update user status");loadUsers(),loadDashboardCounts()}catch(t){console.error("Error updating user status:",t),showError("Kunde inte uppdatera användarstatus")}}async function deleteSport(t){showConfirm("Är du säker på att du vill ta bort denna sport?","Bekräfta borttagning",async()=>{try{if(!(await fetch("http://localhost:3001/api/admin/sports/"+t,{method:"DELETE",headers:{Authorization:"Bearer "+localStorage.getItem("token")}})).ok)throw new Error("Failed to delete sport");loadSports(),loadDashboardCounts(),loadSportsForSelect(),showSuccess("Sporten har tagits bort")}catch(t){console.error("Error deleting sport:",t),showError("Kunde inte ta bort sport")}})}async function deleteSchedule(t){showConfirm("Är du säker på att du vill ta bort detta schema?","Bekräfta borttagning",async()=>{try{if(!(await fetch("http://localhost:3001/api/admin/schedules/"+t,{method:"DELETE",headers:{Authorization:"Bearer "+localStorage.getItem("token")}})).ok)throw new Error("Failed to delete schedule");loadSchedules(),loadDashboardCounts(),showSuccess("Schemat har tagits bort")}catch(t){console.error("Error deleting schedule:",t),showError("Kunde inte ta bort schema")}})}function showAddSportModal(){document.getElementById("add-sport-modal").style.display="block"}function showAddScheduleModal(){document.getElementById("add-schedule-modal").style.display="block"}async function editSport(e){try{var t=await fetch("http://localhost:3001/api/admin/sports",{headers:{Authorization:"Bearer "+localStorage.getItem("token")}});if(!t.ok)throw new Error("Failed to fetch sports");var o=(await t.json()).find(t=>t.id===e);if(!o)throw new Error("Sport not found");document.getElementById("edit-sport-id").value=o.id,document.getElementById("edit-sport-name").value=o.name,document.getElementById("edit-sport-description").value=o.description,document.getElementById("edit-existing-image-path").value=o.image_path||"",document.getElementById("edit-sport-modal").style.display="block"}catch(t){console.error("Error loading sport for edit:",t),showError("Kunde inte ladda sport för redigering")}}async function editSchedule(e){try{var t=await fetch("http://localhost:3001/api/admin/schedules",{headers:{Authorization:"Bearer "+localStorage.getItem("token")}});if(!t.ok)throw new Error("Failed to fetch schedules");var o=(await t.json()).find(t=>t.id===e);if(!o)throw new Error("Schedule not found");document.getElementById("edit-schedule-id").value=o.id,document.getElementById("edit-schedule-sport").value=o.sport_id,document.getElementById("edit-schedule-day").value=o.day_of_week||o.day,document.getElementById("edit-schedule-start-time").value=o.start_time,document.getElementById("edit-schedule-end-time").value=o.end_time,document.getElementById("edit-schedule-age-group").value=o.age_group,document.getElementById("edit-schedule-modal").style.display="block"}catch(t){console.error("Error loading schedule for edit:",t),showError("Kunde inte ladda schema för redigering")}}function closeModal(t){document.getElementById(t).style.display="none"}function showNotification(t,e="info",o="Meddelande",a=null,n=null){var d=document.getElementById("notification-modal"),r=document.getElementById("notification-title"),s=document.getElementById("notification-message"),l=document.getElementById("notification-icon"),i=document.getElementById("notification-confirm-btn"),c=document.getElementById("notification-cancel-btn");r.textContent=o,s.textContent=t,l.className="notification-icon";let u="fas fa-info-circle";switch(e){case"success":u="fas fa-check-circle",l.classList.add("success");break;case"error":u="fas fa-exclamation-triangle",l.classList.add("error");break;case"warning":u="fas fa-exclamation-circle",l.classList.add("warning");break;default:l.classList.add("info")}l.innerHTML=`<i class="${u}"></i>`,a||n?(c.style.display="inline-block",i.textContent="Ja",c.textContent="Avbryt",r=i.cloneNode(!0),o=c.cloneNode(!0),i.parentNode.replaceChild(r,i),c.parentNode.replaceChild(o,c),r.addEventListener("click",()=>{closeNotificationModal(),a&&a()}),o.addEventListener("click",()=>{closeNotificationModal(),n&&n()})):(c.style.display="none",i.textContent="OK",i.onclick=closeNotificationModal),d.style.display="block"}function closeNotificationModal(){document.getElementById("notification-modal").style.display="none"}function showSuccess(t,e="Lyckades"){showNotification(t,"success",e)}function showError(t,e="Fel"){showNotification(t,"error",e)}function showWarning(t,e="Varning"){showNotification(t,"warning",e)}function showConfirm(t,e="Bekräfta",o,a=null){showNotification(t,"warning",e,o,a)}function initializeForms(){document.getElementById("add-sport-form").addEventListener("submit",async function(t){t.preventDefault();var t=new FormData,e=(t.append("name",document.getElementById("sport-name").value),t.append("description",document.getElementById("sport-description").value),document.getElementById("sport-image").files[0]);e&&t.append("image",e);try{if(!(await fetch("http://localhost:3001/api/admin/sports",{method:"POST",headers:{Authorization:"Bearer "+localStorage.getItem("token")},body:t})).ok)throw new Error("Failed to add sport");closeModal("add-sport-modal"),this.reset(),loadSports(),loadDashboardCounts(),loadSportsForSelect(),showSuccess("Sporten har lagts till")}catch(t){console.error("Error adding sport:",t),showError("Kunde inte lägga till sport")}}),document.getElementById("add-schedule-form").addEventListener("submit",async function(t){t.preventDefault();t={sport_id:parseInt(document.getElementById("schedule-sport").value),day_of_week:document.getElementById("schedule-day").value,start_time:document.getElementById("schedule-start-time").value,end_time:document.getElementById("schedule-end-time").value,age_group:document.getElementById("schedule-age-group").value};try{if(!(await fetch("http://localhost:3001/api/admin/schedules",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+localStorage.getItem("token")},body:JSON.stringify(t)})).ok)throw new Error("Failed to add schedule");closeModal("add-schedule-modal"),this.reset(),loadSchedules(),loadDashboardCounts(),showSuccess("Schemat har lagts till")}catch(t){console.error("Error adding schedule:",t),showError("Kunde inte lägga till schema")}}),document.getElementById("edit-sport-form").addEventListener("submit",async function(t){t.preventDefault();var t=document.getElementById("edit-sport-id").value,e=new FormData,o=(e.append("name",document.getElementById("edit-sport-name").value),e.append("description",document.getElementById("edit-sport-description").value),e.append("existing_image_path",document.getElementById("edit-existing-image-path").value),document.getElementById("edit-sport-image").files[0]);o&&e.append("image",o);try{if(!(await fetch("http://localhost:3001/api/admin/sports/"+t,{method:"PUT",headers:{Authorization:"Bearer "+localStorage.getItem("token")},body:e})).ok)throw new Error("Failed to update sport");closeModal("edit-sport-modal"),this.reset(),loadSports(),loadDashboardCounts(),loadSportsForSelect(),showSuccess("Sporten har uppdaterats")}catch(t){console.error("Error updating sport:",t),showError("Kunde inte uppdatera sport")}}),document.getElementById("edit-schedule-form").addEventListener("submit",async function(t){t.preventDefault();var t=document.getElementById("edit-schedule-id").value,e={sport_id:parseInt(document.getElementById("edit-schedule-sport").value),day_of_week:document.getElementById("edit-schedule-day").value,start_time:document.getElementById("edit-schedule-start-time").value,end_time:document.getElementById("edit-schedule-end-time").value,age_group:document.getElementById("edit-schedule-age-group").value};try{if(!(await fetch("http://localhost:3001/api/admin/schedules/"+t,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer "+localStorage.getItem("token")},body:JSON.stringify(e)})).ok)throw new Error("Failed to update schedule");closeModal("edit-schedule-modal"),this.reset(),loadSchedules(),loadDashboardCounts(),showSuccess("Schemat har uppdaterats")}catch(t){console.error("Error updating schedule:",t),alert("Kunde inte uppdatera schema")}})}document.addEventListener("DOMContentLoaded",function(){var t=localStorage.getItem("token"),e=JSON.parse(localStorage.getItem("user")||"null");t&&e&&"admin"===e.role?(document.getElementById("logout-btn").addEventListener("click",function(){localStorage.removeItem("token"),localStorage.removeItem("user"),window.location.href="admin.html"}),document.querySelector(".dashboard-header p").textContent=`Välkommen, ${e.first_name} `+e.last_name,loadDashboardCounts(),loadSportsForSelect(),initializeForms()):window.location.href="admin.html"});