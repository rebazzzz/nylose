document.addEventListener("DOMContentLoaded",function(){var e=document.getElementById("personnummer");let s=document.querySelectorAll(".parent-field"),i=document.getElementById("register-btn"),l=document.querySelector(".registration-form");function o(e,t="info",n="Meddelande"){var a=document.getElementById("notification-modal"),r=document.getElementById("notification-title"),s=document.getElementById("notification-message"),i=document.getElementById("notification-icon");r.textContent=n,s.textContent=e,i.className="notification-icon";let l="fas fa-info-circle";switch(t){case"success":l="fas fa-check-circle",i.classList.add("success");break;case"error":l="fas fa-exclamation-triangle",i.classList.add("error");break;case"warning":l="fas fa-exclamation-circle",i.classList.add("warning");break;default:i.classList.add("info")}i.innerHTML=`<i class="${l}"></i>`,document.getElementById("notification-confirm-btn").onclick=c,a.style.display="flex",a.style.position="fixed",a.style.top="0",a.style.left="0",a.style.width="100%",a.style.height="100%",a.style.zIndex="9999"}function c(){document.getElementById("notification-modal").style.display="none"}function g(e,t="Fel"){o(e,"error",t)}e&&e.addEventListener("input",function(t){let n=t.target.value.replace(/[^0-9]/g,"");if(8<=(n=12<n.length?n.substring(0,12):n).length&&(n=n.substring(0,8)+"-"+n.substring(8)),12===(t.target.value=n).replace(/-/g,"").length){var t=n.replace(/-/g,"").substring(0,8),a=parseInt(t.substring(0,4)),r=parseInt(t.substring(4,6))-1,t=parseInt(t.substring(6,8)),a=new Date(a,r,t),r=new Date;let e=r.getFullYear()-a.getFullYear();t=r.getMonth()-a.getMonth();(t<0||0==t&&r.getDate()<a.getDate())&&e--,e<18?s.forEach(e=>{e.style.display="flex";e=e.querySelector("input");e&&(e.required=!0)}):s.forEach(e=>{e.style.display="none";e=e.querySelector("input");e&&(e.required=!1)})}else s.forEach(e=>{e.style.display="none";e=e.querySelector("input");e&&(e.required=!1)})}),l&&i&&l.addEventListener("submit",async function(e){e.preventDefault();var e=new FormData(l),t=e.get("personnummer").replace(/[^0-9-]/g,""),n=(e=>{if(12!==(e=e.replace(/[^0-9]/g,"")).length)return null;var e=e.substring(0,8),t=parseInt(e.substring(0,4)),n=parseInt(e.substring(4,6))-1,e=parseInt(e.substring(6,8)),t=new Date(t,n,e);let a=(n=new Date).getFullYear()-t.getFullYear();return((e=n.getMonth()-t.getMonth())<0||0==e&&n.getDate()<t.getDate())&&a--,a})(t),n=null!==n&&n<18,t={first_name:e.get("firstname"),last_name:e.get("lastname"),personnummer:t,email:e.get("email"),phone:e.get("phone"),address:e.get("address")};n&&(t.parent_name=e.get("parent-name"),t.parent_lastname=e.get("parent-lastname"),t.parent_phone=e.get("parent-phone")),i.disabled=!0,i.textContent="Registrerar...";try{var a=await fetch("http://localhost:3001/api/auth/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),r=await a.json();a.ok?o("Registrering genomförd! Kontrollera din e-post för bekräftelse.","success","Registrering lyckades"):g("Registrering misslyckades: "+r.error,"Registreringsfel")}catch(e){console.error("Registration error:",e),g("Ett fel uppstod. Försök igen senare.","Fel")}finally{i.disabled=!1,i.textContent="Skicka anmälan"}})});